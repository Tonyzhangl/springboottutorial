<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chinamobile.epic.tinker.dao.ItemBusinessMapper">

    <select id="getBusinessListByUserId" resultType="java.util.HashMap" parameterType="java.util.HashMap">
        select distinct b.id as businessId,b.name as businessName ,c.name as organizationName,a.create_date
        from
        t_bussiness as b
        left join
        t_tenants_target_item_business as a
        on a.business_id = b.id
        left join
        t_organization as c
        on b.organization_id = c.id
        where
        a.is_delete = 0
        <if test="userId != null and userId !=''">
            and a.user_id= #{userId}
        </if>
        <if test="source != null ">
            and a.source = #{source}
        </if>
    </select>


    <!--查询评估详情-->
    <select id="selectByEstimateId" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        select *
        from
        t_tenants_target_item_business as a
        where
        a.estimate_id =#{estimateId}
        and is_delete = 0
        <if test="categoryType != null and  categoryType != ''">
            and
            a.category_type = #{categoryType}
        </if>
    </select>


    <insert id="insertItem" parameterType="com.chinamobile.epic.tinker.entity.ItemBusiness">
        insert into
        t_tenants_target_item_business
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="source != null">
                source,
            </if>
            <if test="categoryType != null">
                category_type,
            </if>
            <if test="userId != null">
                user_id,
            </if>
            <if test="businessId != null">
                business_id,
            </if>
            <if test="businessName != null">
                business_name,
            </if>
            <if test="targetId != null">
                target_id,
            </if>
            <if test="version != null">
                version,
            </if>
            <if test="primaryItemName != null">
                primary_item_name,
            </if>
            <if test="secondaryItemName != null">
                secondary_item_name,
            </if>
            <if test="itemName != null">
                item_name,
            </if>
            <if test="itemDesc != null">
                item_desc,
            </if>
            <if test="levelSet != null">
                level_set,
            </if>
            <if test="itemWeight != null">
                item_weight,
            </if>
            <if test="remark != null">
                remark,
            </if>
            <if test="createDate != null">
                create_date,
            </if>
            <if test="estimateId != null">
                estimate_id,
            </if>
            <if test="itemCommentsId != null">
                item_comments_id,
            </if>
            <if test="templateId != null">
                template_id,
            </if>
            <if test="commentResult != null">
                comment_result,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id},
            </if>
            <if test="source != null">
                #{source},
            </if>
            <if test="categoryType != null">
                #{categoryType},
            </if>
            <if test="userId != null">
                #{userId},
            </if>
            <if test="businessId != null">
                #{businessId},
            </if>
            <if test="businessName != null">
                #{businessName},
            </if>
            <if test="targetId != null">
                #{targetId},
            </if>
            <if test="version != null">
                #{version},
            </if>
            <if test="primaryItemName != null">
                #{primaryItemName},
            </if>
            <if test="secondaryItemName != null">
                #{secondaryItemName},
            </if>
            <if test="itemName != null">
                #{itemName},
            </if>
            <if test="itemDesc != null">
                #{itemDesc},
            </if>
            <if test="levelSet != null">
                #{levelSet},
            </if>
            <if test="itemWeight != null">
                #{itemWeight},
            </if>
            <if test="remark != null">
                #{remark},
            </if>
            <if test="createDate != null">
                #{createDate},
            </if>
            <if test="estimateId != null">
                #{estimateId},
            </if>
            <if test="itemCommentsId != null">
                #{itemCommentsId},
            </if>
            <if test="templateId != null">
                #{templateId},
            </if>
            <if test="commentResult != null">
                #{commentResult},
            </if>
        </trim>
    </insert>


    <update id="updateItem" parameterType="com.chinamobile.epic.tinker.entity.ItemBusiness">
        update
        t_tenants_target_item_business
        <set>
            <if test="source != null">
                source = #{source},
            </if>
            <if test="categoryType != null">
                category_type = #{categoryType},
            </if>
            <if test="userId != null">
                user_id = #{userId},
            </if>
            <if test="businessId != null">
                business_id = #{businessId},
            </if>
            <if test="businessName != null">
                business_name = #{businessName},
            </if>
            <if test="targetId != null">
                target_id =#{targetId},
            </if>
            <if test="version != null">
                version = #{version},
            </if>
            <if test="primaryItemName != null">
                primary_item_name = #{primaryItemName},
            </if>
            <if test="secondaryItemName != null">
                secondary_item_name =  #{secondaryItemName},
            </if>
            <if test="itemName != null">
                item_name = #{itemName},
            </if>
            <if test="itemDesc != null">
                item_desc = #{itemDesc},
            </if>
            <if test="levelSet != null">
                level_set = #{levelSet},
            </if>
            <if test="itemWeight != null">
                item_weight = #{itemWeight},
            </if>
            <if test="commentResult != null">
                comment_result = #{commentResult},
            </if>
            <if test="remark != null">
                remark = #{remark},
            </if>
            <if test="createDate != null">
                create_date = #{createDate},
            </if>
            <if test="isDelete != null">
                is_delete =  #{isDelete},
            </if>
            <if test="estimateId != null">
                estimate_id =  #{estimateId},
            </if>
        </set>
        where
        id =#{id}
    </update>

    <update id="deleteItemComment"  parameterType="java.lang.String">
                    update
                    t_tenants_target_item_comments
                    set
                    is_delete = 1
                    where
                    estimate_id = #{estimateId}
     </update>
    <update id="deleteItem"  parameterType="java.lang.String">
                    update
                    t_tenants_target_item_business
                    set
                    is_delete = 1
                    where
                    estimate_id = #{estimateId}
      </update>

    <select id="selectByCategoryType" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        select a.id,a.version,a.comment_result as commentResult,a.estimate_id as estimateId,a.template_id as templateId,
        a.source,a.category_type as categoryType,a.primary_item_name as primaryItemName,a.secondary_item_name as secondaryItemName,
        a.item_name as itemName,a.item_desc as itemDesc,a.level_set as levelSet,a.item_weight as itemWeight,
        b.totalCommentResult,b.id as commentId,b.totalCommentResult
        from  t_tenants_target_item_business as a
        left join t_tenants_target_item_comments as b
        on a.item_comments_id = b.id
        where
        a.estimate_id = #{estimateId}
        <if test="categoryType != null and categoryType != ''">
            and a.category_type = #{categoryType}
        </if>
        <if test="source != null">
            and a.source = #{source}
        </if>
    </select>

    <insert id="insertItemComments" parameterType="java.util.HashMap">
        insert into t_tenants_target_item_comments
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="categoryType != null">
                category_type,
            </if>
            <if test="userId != null">
                user_id,
            </if>
            <if test="totalCommentResult != null">
                totalCommentResult,
            </if>
            <if test="estimateId != null">
                estimate_id,
            </if>
            <if test="totalDescription != null">
                total_description,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id},
            </if>
            <if test="categoryType != null">
                #{categoryType},
            </if>
            <if test="userId != null">
                #{userId},
            </if>
            <if test="totalCommentResult != null">
                #{totalCommentResult},
            </if>
            <if test="estimateId != null">
                #{estimateId},
            </if>
            <if test="totalDescription != null">
                #{totalDescription},
            </if>
        </trim>
    </insert>

    <select id="selectItemComment" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        select * from
        t_tenants_target_item_comments
        where
        estimate_id = #{estimateId}
        and
        category_type = #{categoryType}
        and
        is_delete =0
    </select>

    <update id="updateItemComment" parameterType="java.util.HashMap">
        update
        t_tenants_target_item_comments
        <set>
            <if test="totalCommentResult != null">
                totalCommentResult = #{totalCommentResult},
            </if>
            <if test="total_description != null">
                totalDescription = #{totalDescription},
            </if>
        </set>
        where
        id =#{id}
    </update>


</mapper>